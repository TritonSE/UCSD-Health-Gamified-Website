import { useRouter } from "next/navigation";
import { Dispatch, MutableRefObject, SetStateAction } from "react";
import toast from "react-hot-toast";

import { ModuleNumbers, UserData } from "../ModuleMap/ModuleMap";

import styles from "./AnimatedPath.module.css";

type AnimatedPathProps = {
  modulePreview: ModuleNumbers;
  setUserData: Dispatch<SetStateAction<UserData>>;
  bikeIsAnimating: MutableRefObject<boolean>;
};

const TOAST_DURATION = 2500;

export default function AnimatedPath({
  modulePreview,
  setUserData,
  bikeIsAnimating,
}: AnimatedPathProps) {
  const isModuleAccessible = modulePreview >= 9;
  const router = useRouter();
  const getStarColor = () => {
    if (modulePreview < 9) return "#B4B4B4";
    return modulePreview === 9 ? "#FFBC00" : "#3BB966";
  };

  return (
    // prettier-ignore
    <>
      <g
        id={styles.path_star}
        className={isModuleAccessible ? styles.active : styles.inactive}
        onClick={() => {
          if (!isModuleAccessible) {
          toast(
            <div className={`${styles.module_error_toast} toast`}>
              <p>
                <span>Error: </span>This module is locked!
              </p>
              <p>{`Make sure you've submitted your answers and passed the previous module quiz.`}</p>
            </div>,
            { id: "module_error_toast", duration: TOAST_DURATION },
          );
          return;
        }
          if (
            modulePreview > 9 ||
            modulePreview < 9 ||
            bikeIsAnimating.current
          )
            return;
          router.push(`/final-test`);
          setUserData((prev) => ({...prev, currentModule: 9}));
        }}
      >
        <path d="M1010.01 875.209L1023.32 848.395C1023.71 847.619 1024.31 846.967 1025.04 846.51C1025.78 846.054 1026.63 845.812 1027.5 845.812C1028.37 845.812 1029.22 846.054 1029.96 846.51C1030.69 846.967 1031.29 847.619 1031.68 848.395L1044.99 875.209L1074.76 879.535C1075.62 879.654 1076.42 880.012 1077.09 880.568C1077.75 881.124 1078.25 881.856 1078.52 882.68C1078.79 883.504 1078.82 884.387 1078.61 885.228C1078.4 886.07 1077.96 886.835 1077.34 887.437L1055.8 908.296L1060.88 937.765C1061.54 941.547 1057.54 944.427 1054.12 942.644L1027.5 928.724L1000.88 942.644C997.462 944.433 993.465 941.547 994.116 937.76L999.2 908.291L977.664 887.432C977.044 886.83 976.606 886.065 976.398 885.225C976.191 884.385 976.224 883.504 976.492 882.682C976.761 881.86 977.254 881.13 977.917 880.574C978.58 880.019 979.386 879.66 980.242 879.54L1010.01 875.209Z" fill={getStarColor()} stroke={getStarColor()} strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" />
      </g>
      <g id={"paths-container"} className={styles.all_road_paths}>
        <g id="module-path-1" mask="url(#road-mask-1)">
          <path d="M558.932 231.037L578.914 225.93L578.914 225.93L558.932 231.037ZM542.517 250.107C545.338 261.143 556.571 267.803 567.607 264.983C578.643 262.162 585.303 250.929 582.483 239.893L542.517 250.107ZM286.629 220.625H518.966V179.375H286.629V220.625ZM538.949 236.143L542.517 250.107L582.483 239.893L578.914 225.93L538.949 236.143ZM518.966 220.625C528.39 220.625 536.615 227.013 538.949 236.143L578.914 225.93C571.914 198.538 547.238 179.375 518.966 179.375V220.625Z" fill="#1C3A29" />
          <rect x="275" y="165" width="28.05" height="69.3" rx="8.25" fill="#1C3A29" />
        </g>
        <path id="module-path-2" mask="url(#road-mask-2)" d="M876.004 250.202C880.258 239.635 875.14 227.62 864.573 223.367C854.006 219.113 841.991 224.231 837.738 234.798L876.004 250.202ZM632.234 402.246H773.009V360.996H632.234V402.246ZM830.408 363.476L876.004 250.202L837.738 234.798L792.142 348.073L830.408 363.476ZM541.127 243.518L572.615 356.925L612.361 345.889L580.873 232.482L541.127 243.518ZM773.009 402.246C798.261 402.246 820.979 386.901 830.408 363.476L792.142 348.073C788.999 355.881 781.426 360.996 773.009 360.996V402.246ZM632.234 360.996C622.968 360.996 614.84 354.817 612.361 345.889L572.615 356.925C580.051 383.709 604.437 402.246 632.234 402.246V360.996Z" fill="#1C3A29" />
        <path id="module-path-3" mask="url(#road-mask-3)" d="M964.006 578C964.006 589.391 973.24 598.625 984.631 598.625C996.022 598.625 1005.26 589.391 1005.26 578H964.006ZM901.343 220.625H943.381V179.375H901.343V220.625ZM964.006 241.25V578H1005.26V241.25H964.006ZM874.297 253.132L882.221 233.523L843.975 218.068L836.051 237.678L874.297 253.132ZM865.123 275.835L874.297 253.132L836.051 237.678L826.877 260.381L865.123 275.835ZM943.381 220.625C954.772 220.625 964.006 229.859 964.006 241.25H1005.26C1005.26 207.077 977.554 179.375 943.381 179.375V220.625ZM901.343 179.375C876.122 179.375 853.424 194.684 843.975 218.068L882.221 233.523C885.37 225.728 892.936 220.625 901.343 220.625V179.375Z" fill="#1C3A29" />
        <path id="module-path-4" mask="url(#road-mask-4)" d="M785.232 620.072C776.988 612.212 763.933 612.523 756.072 620.768C748.212 629.012 748.523 642.067 756.768 649.928L785.232 620.072ZM1005.18 560V539.375H963.932V560H1005.18ZM943.307 656.325H831.513V697.575H943.307V656.325ZM817.281 650.628L785.232 620.072L756.768 649.928L788.816 680.483L817.281 650.628ZM963.932 560V635.7H1005.18V560H963.932ZM831.513 656.325C826.213 656.325 821.117 654.285 817.281 650.628L788.816 680.483C800.324 691.455 815.613 697.575 831.513 697.575V656.325ZM943.307 697.575C977.48 697.575 1005.18 669.873 1005.18 635.7H963.932C963.932 647.091 954.698 656.325 943.307 656.325V697.575Z" fill="#1C3A29" />
        <path id="module-path-5" mask="url(#road-mask-5)" d="M487.07 462.142C482.73 451.61 470.674 446.591 460.142 450.93C449.61 455.27 444.591 467.326 448.93 477.858L487.07 462.142ZM736.667 605.079L723.08 620.596L736.667 605.079ZM709.492 574.237H547.068V615.487H709.492V574.237ZM527.998 561.47L487.07 462.142L448.93 477.858L489.859 577.185L527.998 561.47ZM786.03 620.89L750.254 589.562L723.08 620.596L758.856 651.923L786.03 620.89ZM547.068 574.237C538.712 574.237 531.181 569.196 527.998 561.47L489.859 577.185C499.409 600.363 522 615.487 547.068 615.487V574.237ZM709.492 615.487C714.491 615.487 719.319 617.303 723.08 620.596L750.254 589.562C738.973 579.683 724.488 574.237 709.492 574.237V615.487Z" fill="#1C3A29" />
        <path id="module-path-6" mask="url(#road-mask-6)" d="M94.375 676.95C94.375 688.341 103.609 697.575 115 697.575C126.391 697.575 135.625 688.341 135.625 676.95H94.375ZM297.213 577.098L276.703 574.924L297.213 577.098ZM308.788 467.902L288.278 465.728L308.788 467.902ZM462.486 456.561L481.561 448.717L462.486 456.561ZM424.336 410.375H349.809V451.625H424.336V410.375ZM288.278 465.728L276.703 574.924L317.723 579.272L329.299 470.076L288.278 465.728ZM256.193 593.375H156.25V634.625H256.193V593.375ZM94.375 655.25V676.95H135.625V655.25H94.375ZM490.583 470.656L481.561 448.717L443.411 464.405L452.433 486.344L490.583 470.656ZM156.25 593.375C122.077 593.375 94.375 621.077 94.375 655.25H135.625C135.625 643.859 144.859 634.625 156.25 634.625V593.375ZM276.703 574.924C275.591 585.415 266.742 593.375 256.193 593.375V634.625C287.841 634.625 314.387 610.744 317.723 579.272L276.703 574.924ZM349.809 410.375C318.161 410.375 291.614 434.256 288.278 465.728L329.299 470.076C330.411 459.585 339.259 451.625 349.809 451.625V410.375ZM424.336 451.625C432.697 451.625 440.231 456.673 443.411 464.405L481.561 448.717C472.02 425.518 449.419 410.375 424.336 410.375V451.625Z" fill="#1C3A29" />
        <path id="module-path-7" mask="url(#road-mask-7)" d="M396.844 876.205C404.137 867.454 402.955 854.449 394.205 847.156C385.454 839.863 372.449 841.045 365.156 849.795L396.844 876.205ZM359.198 889.16L375.041 902.364L359.198 889.16ZM156.25 924.625H327.51V883.375H156.25V924.625ZM375.041 902.364L396.844 876.205L365.156 849.795L343.354 875.955L375.041 902.364ZM94.375 671L94.375 862.75L135.625 862.75L135.625 671L94.375 671ZM327.51 924.625C345.872 924.625 363.286 916.47 375.041 902.364L343.354 875.955C339.435 880.657 333.631 883.375 327.51 883.375V924.625ZM156.25 883.375C144.859 883.375 135.625 874.141 135.625 862.75L94.375 862.75C94.3751 896.923 122.077 924.625 156.25 924.625V883.375Z" fill="#1C3A29" />
        <path id="module-path-8" mask="url(#road-mask-8)" d="M642.5 777.625C653.891 777.625 663.125 768.391 663.125 757C663.125 745.609 653.891 736.375 642.5 736.375V777.625ZM488.847 777.625H642.5V736.375H488.847V777.625ZM389.843 884.818L473.003 785.045L441.316 758.634L358.157 858.407L389.843 884.818ZM488.847 736.375C470.485 736.375 453.072 744.53 441.316 758.634L473.003 785.045C476.922 780.343 482.726 777.625 488.847 777.625V736.375Z" fill="#1C3A29" />
        <g id="module-path-9" mask="url(#road-mask-9)">
          <path d="M922.5 904.613H767.562C752.693 904.613 738.975 896.61 731.656 883.668L671.851 777.913C664.543 764.99 650.846 757 636 757V757" stroke="#1C3A29" strokeWidth="41.25" />
          <path d="M910.889 943.388C905.398 946.58 898.511 942.63 898.493 936.279L898.308 871.403C898.289 865.052 905.153 861.063 910.662 864.223L966.939 896.5C972.449 899.66 972.471 907.598 966.98 910.789L910.889 943.388Z" fill="#1C3A29" />
        </g>
      </g>
    </>
  );
}
